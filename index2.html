<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Palace TS</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Addons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.2.1/redux.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/8.1.1/react-redux.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs/plugin/duration.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/antd@5.23.2/dist/antd.min.js"
      integrity="sha256-114FWs2M03cfm1zccnFoL4Qr8qIVbToUNXURoByPxlk="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@ant-design/icons@5.6.0/dist/index.umd.min.js"
      integrity="sha256-xchEIltPJ+oBJfYKlnosRWZt2yTpJEZdipjAmLb1GAM="
      crossorigin="anonymous"
    ></script>
    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
      }

      .table-soccer {
        width: 18vw;
        max-width: 600px;
        height: 55vh;
        background-color: green;
        border: 10px solid #654321;
        border-radius: 10px;
        position: relative;
        overflow: visible;
        display: flex;
        flex-direction: column;
        justify-content: space-evenly;
      }

      .rod {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 8px;
        background-color: #555;
        border-radius: 5px;
        margin: 0;
        overflow: visible;
      }

      .player {
        width: 30px;
        height: 20px;
        border-radius: 50%;
        border: 2px solid white;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 0 4px;
        cursor: grab;
        position: relative;
      }
      .blue {
        background-color: blue;
      }
      .red {
        background-color: red;
      }
      .handle {
        display: flex;
        justify-content: center;
        align-items: center;
        position: absolute;
      }

      .handle-left {
        left: -70px;
        top: 50%;
        transform: translateY(-50%);
      }

      .handle-right {
        right: -80px;
        top: 50%;
        transform: translateY(-50%);
      }
      .goal {
        width: 75px;
        height: 30px;
        background: gray;
        align-self: center;
        margin: -6vh 0;
      }

      /* Pop-back animation */
      @keyframes pop-back {
        0% {
          transform: translate(0, 0) scale(1.2);
        }
        50% {
          transform: translate(0, 0) scale(0.8);
        }
        100% {
          transform: translate(0, 0) scale(1);
        }
      }

      .pop-back {
        animation: pop-back 0.5s ease-out;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      const { useState } = React;
      const { createStore } = Redux;
      const { Provider, useSelector, useDispatch } = ReactRedux;
      const { Button, Col, Flex, Layout, Menu, Row, theme } = antd;
      const { Header, Footer, Sider, Content } = Layout;
      const { MenuUnfoldOutlined, MenuFoldOutlined } = icons;
      const loadState = () => {
        try {
          const serializedState = localStorage.getItem("reduxState");
          if (serializedState === null) {
            return undefined;
          }
          return JSON.parse(serializedState);
        } catch (err) {
          console.error("Failed to load state from localStorage:", err);
          return undefined;
        }
      };
      const saveState = (state) => {
        try {
          const serializedState = JSON.stringify(state);
          localStorage.setItem("reduxState", serializedState);
        } catch (err) {
          console.error("Failed to save state to localStorage:", err);
        }
      };
      const initialState = {
        count: 0,
      };
      function counterReducer(state = initialState, action) {
        switch (action.type) {
          case "INCREMENT":
            return { ...state, count: state.count + 1 };
          case "DECREMENT":
            return { ...state, count: state.count - 1 };
          default:
            return state;
        }
      }
      const persistedState = loadState();
      const store = createStore(counterReducer, persistedState);
      store.subscribe(() => {
        saveState(store.getState());
      });
      const handleSVG = (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="60"
          height="20"
          viewBox="0 0 60 20"
          fill="none"
        >
          <rect x="0" y="5" width="50" height="10" fill="#333" rx="5" />
          <circle cx="5" cy="10" r="5" fill="#555" />
          <rect x="10" y="7" width="35" height="6" fill="#444" rx="3" />
        </svg>
      );
      function TableSoccer() {
        const rows = [
          { team: "red", player: 1 },
          { team: "red", player: 2 },
          { team: "blue", player: 3 },
          { team: "red", player: 5 },
          { team: "blue", player: 5 },
          { team: "red", player: 3 },
          { team: "blue", player: 2 },
          { team: "blue", player: 1 },
        ];
        const handleDragStart = (e, playerInfo) => {
          e.dataTransfer.setData("player", JSON.stringify(playerInfo));
          const rect = e.target.getBoundingClientRect();
          e.target.dataset.originalX = rect.left;
          e.target.dataset.originalY = rect.top;
          e.target.style.opacity = "0.5";
        };
        const handleDragEnd = (e) => {
          e.target.style.opacity = "1";
        };
        const handleDrop = (e, goalTeam) => {
          console.log(goalTeam);
          e.preventDefault();
          const playerData = JSON.parse(e.dataTransfer.getData("player"));
          console.log(
            `Player ${playerData.index} dragged into ${goalTeam} goal`
          );

          const player = document.querySelector(
            `[data-index="${playerData.index}"]`
          );
          if (player) {
            player.classList.add("pop-back");

            // Remove the animation class after animation completes
            player.addEventListener(
              "animationend",
              () => {
                player.classList.remove("pop-back");
              },
              { once: true }
            );
          }
        };
        const handleDragOver = (e) => {
          e.preventDefault();
        };

        return (
          <div className="table-soccer">
            <div
              className="goal red"
              onDragOver={handleDragOver}
              onDrop={(e) => handleDrop(e, "red")}
              onTouchEnd={handleDragEnd}
            ></div>
            {rows.map((row, rowIndex) => (
              <div key={rowIndex} className="rod">
                {row.team === "red" && (
                  <div className="handle handle-left">{handleSVG}</div>
                )}
                {Array.from({ length: row.player }).map((_, i) => (
                  <div
                    key={i}
                    className={`player ${row.team}`}
                    draggable
                    onDragStart={(e) =>
                      handleDragStart(e, {
                        team: row.team,
                        index: `${rowIndex}-${i}`,
                      })
                    }
                    onDragEnd={handleDragEnd}
                    onTouchEnd={handleDragEnd}
                    onTouchMove={(e) =>
                      handleDrop(e, {
                        team: row.team,
                        index: `${rowIndex}-${i}`,
                      })
                    }
                    onTouchStart={(e) =>
                      handleDragStart(e, {
                        team: row.team,
                        index: `${rowIndex}-${i}`,
                      })
                    }
                    data-index={`${rowIndex}-${i}`}
                  ></div>
                ))}
                {row.team === "blue" && (
                  <div className="handle handle-right">{handleSVG}</div>
                )}
              </div>
            ))}
            <div
              className="goal blue"
              onDragOver={handleDragOver}
              onDrop={(e) => handleDrop(e, "blue")}
              onTouchEnd={handleDragEnd}
            ></div>
          </div>
        );
      }
      function App() {
        const [collapsed, setCollapsed] = useState(false);
        const {
          token: { colorBgContainer, borderRadiusLG },
        } = theme.useToken();
        const count = useSelector((state) => state.count);
        const dispatch = useDispatch();
        return (
          <Layout
            style={{
              height: "100vh",
            }}
          >
            <Header
              style={{
                padding: 0,
                background: colorBgContainer,
              }}
            >
              Header
            </Header>
            <Content>
              <Flex vertical gap="middle">
                <Row>
                  <Col span="24">
                    <div>Column Pause</div>
                  </Col>
                  <Col span="24">
                    <div>Column Undo</div>
                  </Col>
                </Row>
                <Row>
                  <Col span="24">
                    <div>Column 1</div>
                  </Col>
                  <Col span="24">
                    <div>
                      <TableSoccer />
                    </div>
                  </Col>
                  <Col span="24">
                    <div>Column 3</div>
                  </Col>
                </Row>
              </Flex>
            </Content>
            <Footer>Footer</Footer>
          </Layout>
        );
      }
      const container = document.getElementById("root");
      const root = ReactDOM.createRoot(container);
      root.render(
        <Provider store={store}>
          <App />
        </Provider>
      );
    </script>
  </body>
</html>
